# Auto-Generated Files Policy

**CRITICAL**: The following files are AUTO-GENERATED. NEVER manually edit these files.

## Auto-Generated Files List

| File/Directory | Generated By | Command |
|----------------|--------------|---------|
| `frontend/packages/types/schema.ts` | Supabase CLI | `make build-model-frontend` |
| `frontend/packages/api-client/src/generated/` | Hey API (@hey-api/openapi-ts) | `make build-model-frontend` |
| `supabase/functions/shared/types/supabase/schema.ts` | Supabase CLI | `make build-model-functions` |
| `supabase/functions/shared/drizzle/` | Copy from `drizzle/schema/` | `make build-model-functions` |
| `backend-py/app/src/domain/entity/models.py` | sqlacodegen | Docker container startup |

## Generation Mechanism

### Frontend & Edge Functions Types

Generated via `supabase gen types typescript --local`:

```bash
make build-model-frontend   # Frontend types
make build-model-functions  # Edge Functions types
make build-model            # All types
```

### Backend API Client (Hey API)

Generated via `@hey-api/openapi-ts` from backend-py's OpenAPI schema:

```bash
make build-model-frontend   # Includes API client generation
# Or directly:
cd frontend && bun run --filter @workspace/api-client generate
```

**Generated files:**
- `types.gen.ts` - TypeScript type definitions
- `sdk.gen.ts` - SDK functions (getHealthcheck, postApiChat, etc.)
- `@tanstack/react-query` hooks (if plugin enabled)

### Backend Python Models

**Automatically generated on container startup** via `docker-compose.backend.yaml`:

```bash
uv run sqlacodegen "$DIRECT_URL" --generator sqlmodels --options nojoined --outfile src/domain/entity/models.py
```

This runs every time `make run` or `docker-compose up` is executed.

## Prohibited Actions

**NEVER**:
- Manually edit any auto-generated file
- Add custom code to auto-generated files
- Modify the file structure of auto-generated directories
- Commit local modifications to auto-generated files

```python
# ❌ WRONG: Editing models.py directly
# backend-py/app/src/domain/entity/models.py
class User(SQLModel):
    custom_field: str  # DO NOT add fields here!

# ✅ CORRECT: Modify the database schema
# drizzle/schema/users.ts
export const users = pgTable('users', {
  customField: text('custom_field'),  // Add column here
})
# Then run: make migrate-dev
```

## Correct Workflow

When you need to change data models:

1. **Edit Drizzle schema**: `drizzle/schema/*.ts`
2. **Request migration**: Ask user to run `make migrate-dev`
3. **Types auto-regenerate**: `make build-model` is included in `migrate-dev`
4. **Backend models auto-regenerate**: Restart container with `make run`

## Why This Policy Exists

- Auto-generated files are **overwritten** on every generation
- Manual changes will be **lost** without warning
- Source of truth is the **database schema** (Drizzle), not the generated types
- Ensures **consistency** between database and all application layers

## Enforcement

If you see a need to modify auto-generated files, **STOP** and:
1. Identify the correct source file (usually in `drizzle/schema/`)
2. Make changes there instead
3. Regenerate types using appropriate `make` commands
